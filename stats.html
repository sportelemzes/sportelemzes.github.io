<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Statisztika – SportElemzés</title>
  <link rel="stylesheet" href="/assets/style.css" />
  <style>
    .card { background:#121212;border:1px solid #2a2a2a;border-radius:14px;padding:18px; }
    table.stats{ width:100%; border-collapse:collapse; margin-top:12px }
    table.stats th, table.stats td{ padding:10px 12px; border-bottom:1px solid #262626; text-align:left; }
    table.stats th{ color:#cfcfcf; font-weight:700; letter-spacing:.03em; font-size:13px; }
    table.stats td{ color:#e8e8e8; font-size:14px; }
    .num{ text-align:right; font-variant-numeric:tabular-nums; }
    .pill{ display:inline-block; background:#222; border:1px solid #333; padding:.15rem .5rem; border-radius:999px; font-size:12px; color:#ddd }
    .ok{ color:#43d17c } .bad{ color:#ff6b6b }
  </style>
</head>
<body>
<header class="header-hero">
  <nav class="hero-nav">
    <a class="brand" href="/"><span>SportElemzés</span></a>
    <div class="links">
      <a href="/">Elemzések</a>
      <a class="active" href="/stats.html">Statisztika</a>
    </div>
  </nav>
  <div class="hero-inner">
    <h1>Statisztika</h1>
    <p class="muted">Havi P/L, tippek és eredmények</p>
  </div>
</header>

<main class="main">
  <section class="card">
    <h2>Havi P/L és tippek</h2>
    <p class="muted" id="plNote">Még nincs lezárt tipp – a grafikon az első lezárás után jelenik meg.</p>

    <h3 style="margin-top:12px">Tippek</h3>
    <table class="stats" id="tab">
      <thead>
        <tr>
          <th>Dátum</th>
          <th>Meccs</th>
          <th>Piac</th>
          <th>Tipp</th>
          <th class="num">Odds</th>
          <th class="num">Tét</th>
          <th>Eredmény</th>
          <th class="num">Profit</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </section>
</main>

<footer class="muted" style="text-align:center;padding:24px 0">
 <div class="links">
   <a href="/">Elemzések</a>
   <a href="/stats.html">Statisztika</a>
   <a href="/privacy.html">Adatkezelés</a>
 </div>
 <div style="margin-top:8px">© <span id="y"></span> SportElemzés • GitHub Pages</div>
</footer>

<script src="/assets/site.js" defer></script>
<script>
(async () => {
  const rows = document.getElementById('rows');
  const fmt = window.__fmt;

  try {
    const r = await fetch('/data/picks.json?ts='+Date.now());
    if (!r.ok) throw new Error('picks.json not found');
    const picks = await r.json();

    // csak rendezett lista (legújabb fent)
    picks.sort((a,b)=> (b.kickoff||'').localeCompare(a.kickoff||''));

    const tr = s => {
      const el = document.createElement('tr');
      el.innerHTML = s;
      rows.appendChild(el);
    };

    for (const p of picks) {
      const d = p.kickoff ? new Date(p.kickoff) : null;
      const date = d ? fmt.date(d) : '';

      // Emberi meccsnév
      let match = '';
      if (p.home && p.away) match = `${p.home} – ${p.away}`;
      else if (p.eventId && p.eventId.includes('-')) {
        const [h,a]=p.eventId.split('-');
        match = fmt.alias(h)+' – '+fmt.alias(a);
      } else match = p.eventId || '';

      // Piac
      let market = fmt.market(p);

      // Tipp cimke
      const tip = p.selection + (p.line!=null && p.market!=='h2h' ? ` ${fmt.line(p.line)}` : '');

      // Profit színezés
      let prof = p.profit==null ? '—' : fmt.money(p.profit);
      if (p.profit>0) prof = `<span class="ok">${prof}</span>`;
      if (p.profit<0) prof = `<span class="bad">${prof}</span>`;

      tr(`
        <td>${date}</td>
        <td>${match}</td>
        <td><span class="pill">${market}</span></td>
        <td>${tip}</td>
        <td class="num">${p.odds? Number(p.odds).toFixed(2) : '—'}</td>
        <td class="num">${fmt.money(p.stake||0)}</td>
        <td>${p.status || 'open'}</td>
        <td class="num">${prof}</td>
      `);
    }

    if (picks.some(p=>p.status!=='open')) {
      document.getElementById('plNote').textContent =
        'A grafikon az első lezárt tipp után jelenik meg. (Később ide jön egy kumulált P/L oszlopdiagram.)';
    }
  } catch (e) {
    rows.innerHTML = `<tr><td colspan="8">Nem sikerült betölteni a tippeket. (${e.message})</td></tr>`;
  }
})();
</script>
</body>
</html>
