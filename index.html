<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SportElemzés</title>
  <meta name="description" content="Elemzések, adatok, eredmények – naponta frissítve">
  <link rel="stylesheet" href="/assets/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚽</text></svg>">
</head>
<body>

<header class="header-hero">
  <nav class="hero-nav">
    <a class="brand" href="/"><span>SportElemzés</span></a>
    <div class="links">
      <a href="/">Elemzések</a>
      <a href="/stats.html">Statisztika</a>
      <!-- Az Admin linket dinamikusan injektáljuk a token alapjan -->
    </div>
  </nav>

  <div class="hero-inner">
    <h1>SportElemzés</h1>
    <p>Elemzések, adatok, eredmények – naponta frissítve</p>
  </div>
</header>

<main>
  <section>
    <h2>Friss elemzések</h2>
    <div id="posts" class="card-list"></div>
  </section>
</main>

<footer>
  <small>© 2025 <strong>SportElemzés</strong> • <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a></small>
</footer>

<script>
// ------- Admin link injektálása csak token esetén -------
(function () {
  var hasToken = !!localStorage.getItem('gh_token');
  if (!hasToken) return;
  var links = document.querySelector('.hero-nav .links');
  if (!links) return;
  var a = document.createElement('a');
  a.href = '/admin/';
  a.textContent = 'Admin';
  a.rel = 'nofollow';
  links.appendChild(a);
})();

// ------- Posztok listázása -------
async function loadPosts() {
  const box = document.getElementById('posts');
  try {
    const r = await fetch('/posts/index.json', { cache: 'no-store' });
    if (!r.ok) throw new Error('HTTP ' + r.status);
    const arr = await r.json();
    if (!Array.isArray(arr) || arr.length === 0) {
      box.innerHTML = '<p>Még nincs közzétett elemzés.</p>';
      return;
    }
    const fmt = (iso) => {
      try {
        return new Date(iso).toLocaleDateString('hu-HU', {
          year: 'numeric', month: '2-digit', day: '2-digit'
        });
      } catch (e) {
        return iso;
      }
    };

    box.innerHTML = arr.map(p => `
      <a class="card" href="/posts/${p.slug}.html">
        <div class="summary">
          <h3>${p.title}</h3>
          <div class="meta">${fmt(p.date)} • ${p.league || ''}</div>
          <p>${(p.excerpt || '').replace(/<[^>]+>/g,'')}</p>
          <span class="more">Tovább →</span>
        </div>
      </a>
    `).join('');
  } catch (e) {
    box.innerHTML = '<p>Nem sikerült betölteni az elemzéseket.</p>';
    console.error(e);
  }
}
loadPosts();
</script>
</body>
</html>
